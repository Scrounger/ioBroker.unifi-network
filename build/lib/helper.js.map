{
  "version": 3,
  "sources": ["../../src/lib/helper.ts"],
  "sourcesContent": ["import _ from \"lodash\";\r\nimport { myCommonState, myCommoneChannelObject, myCommonChannelArray } from \"./myTypes.js\";\r\n\r\nexport function isDeviceCommonEqual(objCommon: ioBroker.DeviceCommon, myCommon: ioBroker.DeviceCommon): boolean {\r\n    return (!myCommon.name || _.isEqual(objCommon.name, myCommon.name)) &&\r\n        (!myCommon.icon || objCommon.icon === myCommon.icon) &&\r\n        objCommon.desc === myCommon.desc &&\r\n        objCommon.role === myCommon.role &&\r\n        _.isEqual(objCommon.statusStates, myCommon.statusStates)\r\n}\r\n\r\nexport function isChannelCommonEqual(objCommon: ioBroker.ChannelCommon, myCommon: ioBroker.ChannelCommon): boolean {\r\n    return (!myCommon.name || _.isEqual(objCommon.name, myCommon.name)) &&\r\n        (!myCommon.icon || objCommon.icon === myCommon.icon) &&\r\n        objCommon.desc === myCommon.desc &&\r\n        objCommon.role === myCommon.role\r\n}\r\n\r\nexport function getObjectByString(path, obj, separator = '.') {\r\n    const properties = Array.isArray(path) ? path : path.split(separator);\r\n    return properties.reduce((prev, curr) => prev?.[curr], obj);\r\n}\r\n\r\nexport function getAllowedCommonStates(path, obj, separator = '.') {\r\n    const objByString = getObjectByString(path, obj, separator);\r\n    const states = {};\r\n\r\n    if (objByString) {\r\n        for (const str of objByString) {\r\n            states[str] = str;\r\n        }\r\n\r\n        return states;\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\n/** Compare common properties of State\r\n * @param {ioBroker.StateCommon} objCommon\r\n * @param {ioBroker.StateCommon} myCommon\r\n * @returns {boolean}\r\n */\r\nexport function isStateCommonEqual(objCommon: ioBroker.StateCommon, myCommon: ioBroker.StateCommon): boolean {\r\n    return _.isEqual(objCommon.name, myCommon.name) &&\r\n        _.isEqual(objCommon.type, myCommon.type) &&\r\n        _.isEqual(objCommon.read, myCommon.read) &&\r\n        _.isEqual(objCommon.write, myCommon.write) &&\r\n        _.isEqual(objCommon.role, myCommon.role) &&\r\n        _.isEqual(objCommon.def, myCommon.def) &&\r\n        _.isEqual(objCommon.unit, myCommon.unit) &&\r\n        _.isEqual(objCommon.icon, myCommon.icon) &&\r\n        _.isEqual(objCommon.desc, myCommon.desc) &&\r\n        _.isEqual(objCommon.max, myCommon.max) &&\r\n        _.isEqual(objCommon.min, myCommon.min) &&\r\n        _.isEqual(objCommon.states, myCommon.states);\r\n}\r\n\r\nexport function zeroPad(source: any, places: number): string {\r\n    const zero = places - source.toString().length + 1;\r\n    return Array(+(zero > 0 && zero)).join('0') + source;\r\n}\r\n\r\n/**\r\n * Id without last part\r\n * @param id \r\n * @returns \r\n */\r\nexport function getIdWithoutLastPart(id: string): string {\r\n    const lastIndex = id.lastIndexOf('.');\r\n    return id.substring(0, lastIndex);\r\n}\r\n\r\n/**\r\n * last part of id\r\n * @param id \r\n * @returns \r\n */\r\nexport function getIdLastPart(id: string): string {\r\n    let result = id.split('.').pop();\r\n    return result ? result : \"\";\r\n}\r\n\r\n/**\r\n * Compare two objects and return properties that are diffrent\r\n *\r\n * @param object\r\n * @param base\r\n * @param adapter\r\n * @param allowedKeys\r\n * @param prefix\r\n * @returns\r\n */\r\nexport const deepDiffBetweenObjects = (object: any, base: any, adapter: ioBroker.Adapter, allowedKeys: any = undefined, prefix: string = ''): any => {\r\n    const logPrefix = '[deepDiffBetweenObjects]:';\r\n\r\n    try {\r\n        const changes = (object, base, prefixInner = ''): any => {\r\n            return _.transform(object, (result, value, key) => {\r\n                const fullKey: string = prefixInner ? `${prefixInner}.${key as string}` : (key as string);\r\n\r\n                try {\r\n                    if (!_.isEqual(value, base[key]) && ((allowedKeys && allowedKeys.includes(fullKey)) || allowedKeys === undefined)) {\r\n                        if (_.isArray(value)) {\r\n\r\n                            if (_.some(value, (item: any) => _.isObject(item))) {\r\n                                // objects in array exists\r\n                                const tmp = [];\r\n                                let empty = true;\r\n\r\n                                for (let i = 0; i <= value.length - 1; i++) {\r\n                                    const res = deepDiffBetweenObjects(value[i], base[key] && base[key][i] ? base[key][i] : {}, adapter, allowedKeys, fullKey);\r\n\r\n                                    if (!_.isEmpty(res) || res === 0 || res === false) {\r\n                                        // if (!_.has(result, key)) result[key] = [];\r\n                                        tmp.push(res);\r\n                                        empty = false;\r\n                                    } else {\r\n                                        tmp.push(null);\r\n                                    }\r\n                                }\r\n\r\n                                if (!empty) {\r\n                                    result[key] = tmp;\r\n                                }\r\n                            } else {\r\n                                // is pure array\r\n                                adapter.log.warn(`${key.toString()}: pure Array (base: ${base[key]}, val: ${value})`);\r\n                                if (!_.isEqual(value, base[key])) {\r\n                                    result[key] = value\r\n                                }\r\n                            }\r\n                        } else if (_.isObject(value) && _.isObject(base[key])) {\r\n                            const res = changes(value, base[key] ? base[key] : {}, fullKey);\r\n                            if (!_.isEmpty(res) || res === 0 || res === false) {\r\n                                result[key] = res;\r\n                            }\r\n                        } else {\r\n                            result[key] = value;\r\n                        }\r\n                    }\r\n                } catch (error) {\r\n                    adapter.log.error(`${logPrefix} transform error: ${error}, stack: ${error.stack}, fullKey: ${fullKey}, object: ${JSON.stringify(object)}, base: ${JSON.stringify(base)}`);\r\n                }\r\n            });\r\n        };\r\n\r\n        return changes(object, base, prefix);\r\n    } catch (error) {\r\n        adapter.log.error(`${logPrefix} error: ${error}, stack: ${error.stack}, object: ${JSON.stringify(object)}, base: ${JSON.stringify(base)}`);\r\n    }\r\n\r\n    return object;\r\n};\r\n\r\n/**\r\n * Collect all properties used in tree defintions\r\n *\r\n * @param treefDefintion @see tree-devices.ts @see tree-clients.ts\r\n * @returns\r\n */\r\nexport function getAllKeysOfTreeDefinition(treefDefintion: { [key: string]: myCommonState | myCommoneChannelObject | myCommonChannelArray }): string[] {\r\n    const keys = [];\r\n\r\n    // Hilfsfunktion f\u00FCr rekursive Durchsuchung des Objekts\r\n    function recurse(currentObj, prefix = ''): void {\r\n        _.forOwn(currentObj, (value, key) => {\r\n            const fullKey = (prefix ? `${prefix}.${key}` : key).replace('.array', '').replace('.object', '');\r\n\r\n            // Wenn der Wert ein Objekt ist (und kein Array), dann weiter rekursiv gehen\r\n            if (_.isObject(value) && typeof value !== 'function' && key !== 'states') {\r\n                keys.push(fullKey);\r\n\r\n                // Wenn es ein Array oder Object ist, dann rekursiv weitergehen\r\n                if (_.isArray(value) || _.isObject(value)) {\r\n                    // Nur unter \"array\" oder \"object\" rekursiv weiter\r\n                    recurse(value, fullKey);\r\n                }\r\n            } else {\r\n                if (key === 'valFromProperty') {\r\n                    const prefixCleared = getIdWithoutLastPart(prefix);\r\n                    keys.push(`${prefixCleared ? `${prefixCleared}.` : ''}${value}`);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Start der Rekursion\r\n    recurse(treefDefintion);\r\n\r\n    return _.uniq(keys);\r\n}\r\n\r\nexport function getAllIdsOfTreeDefinition(treefDefintion: { [key: string]: myCommonState | myCommoneChannelObject | myCommonChannelArray }): string[] {\r\n    const keys = [];\r\n\r\n    // Hilfsfunktion f\u00FCr rekursive Durchsuchung des Objekts\r\n    function recurse(currentObj, prefix = ''): void {\r\n        _.forOwn(currentObj, (value, key) => {\r\n            let fullKey = prefix ? `${prefix}.${key}` : key;\r\n\r\n            if (Object.hasOwn(value, 'idChannel') && !_.isObject(value.idChannel)) {\r\n                fullKey = prefix ? `${prefix}.${value.idChannel}` : value.idChannel;\r\n            } else if (Object.hasOwn(value, 'id') && !_.isObject(value.id)) {\r\n                fullKey = prefix ? `${prefix}.${value.id}` : value.id;\r\n            }\r\n\r\n            fullKey = fullKey.replace('.array', '').replace('.object', '');\r\n\r\n            // Wenn der Wert ein Objekt ist (und kein Array), dann weiter rekursiv gehen\r\n            if (_.isObject(value) && typeof value !== 'function' && key !== 'states') {\r\n                if (!_.has(value, 'required')) {\r\n                    keys.push(fullKey);\r\n                }\r\n\r\n                // Wenn es ein Array oder Object ist, dann rekursiv weitergehen\r\n                if (_.isArray(value) || _.isObject(value)) {\r\n                    // Nur unter \"array\" oder \"object\" rekursiv weiter\r\n                    recurse(value, fullKey);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Start der Rekursion\r\n    recurse(treefDefintion);\r\n\r\n    return _.uniq(keys);\r\n}\r\n\r\nexport function radioToFrequency(radioVal: string, adapter: ioBroker.Adapter): string {\r\n    if (radioVal === 'ng') {\r\n        return '2.4 GHz'\r\n    } else if (radioVal === 'na') {\r\n        return '5 GHz'\r\n    } else {\r\n        adapter.log.warn(`radio ${radioVal} interpreter not implemented! Please create an issue on github.`);\r\n        return radioVal\r\n    }\r\n}\r\n\r\nexport function radio_nameToFrequency(radio_nameVal: string, adapter: ioBroker.Adapter): string {\r\n    if (radio_nameVal === 'wifi0' || radio_nameVal === 'ra0') {\r\n        return '2.4 GHz'\r\n    } else if (radio_nameVal === 'wifi1' || radio_nameVal === 'rai0') {\r\n        return '5 GHz'\r\n    } else {\r\n        adapter.log.warn(`radio ${radio_nameVal} interpreter not implemented! Please create an issue on github.`);\r\n        return 'n/a'\r\n    }\r\n}"],
  "mappings": "AAAA,OAAO,OAAO;AAGP,SAAS,oBAAoB,WAAkC,UAA0C;AAC5G,UAAQ,CAAC,SAAS,QAAQ,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,OAC5D,CAAC,SAAS,QAAQ,UAAU,SAAS,SAAS,SAC/C,UAAU,SAAS,SAAS,QAC5B,UAAU,SAAS,SAAS,QAC5B,EAAE,QAAQ,UAAU,cAAc,SAAS,YAAY;AAC/D;AAEO,SAAS,qBAAqB,WAAmC,UAA2C;AAC/G,UAAQ,CAAC,SAAS,QAAQ,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,OAC5D,CAAC,SAAS,QAAQ,UAAU,SAAS,SAAS,SAC/C,UAAU,SAAS,SAAS,QAC5B,UAAU,SAAS,SAAS;AACpC;AAEO,SAAS,kBAAkB,MAAM,KAAK,YAAY,KAAK;AAC1D,QAAM,aAAa,MAAM,QAAQ,IAAI,IAAI,OAAO,KAAK,MAAM,SAAS;AACpE,SAAO,WAAW,OAAO,CAAC,MAAM,SAAS,6BAAO,OAAO,GAAG;AAC9D;AAEO,SAAS,uBAAuB,MAAM,KAAK,YAAY,KAAK;AAC/D,QAAM,cAAc,kBAAkB,MAAM,KAAK,SAAS;AAC1D,QAAM,SAAS,CAAC;AAEhB,MAAI,aAAa;AACb,eAAW,OAAO,aAAa;AAC3B,aAAO,GAAG,IAAI;AAAA,IAClB;AAEA,WAAO;AAAA,EACX;AAEA,SAAO;AACX;AAOO,SAAS,mBAAmB,WAAiC,UAAyC;AACzG,SAAO,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KAC1C,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KACvC,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KACvC,EAAE,QAAQ,UAAU,OAAO,SAAS,KAAK,KACzC,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KACvC,EAAE,QAAQ,UAAU,KAAK,SAAS,GAAG,KACrC,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KACvC,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KACvC,EAAE,QAAQ,UAAU,MAAM,SAAS,IAAI,KACvC,EAAE,QAAQ,UAAU,KAAK,SAAS,GAAG,KACrC,EAAE,QAAQ,UAAU,KAAK,SAAS,GAAG,KACrC,EAAE,QAAQ,UAAU,QAAQ,SAAS,MAAM;AACnD;AAEO,SAAS,QAAQ,QAAa,QAAwB;AACzD,QAAM,OAAO,SAAS,OAAO,SAAS,EAAE,SAAS;AACjD,SAAO,MAAM,EAAE,OAAO,KAAK,KAAK,EAAE,KAAK,GAAG,IAAI;AAClD;AAOO,SAAS,qBAAqB,IAAoB;AACrD,QAAM,YAAY,GAAG,YAAY,GAAG;AACpC,SAAO,GAAG,UAAU,GAAG,SAAS;AACpC;AAOO,SAAS,cAAc,IAAoB;AAC9C,MAAI,SAAS,GAAG,MAAM,GAAG,EAAE,IAAI;AAC/B,SAAO,SAAS,SAAS;AAC7B;AAYO,MAAM,yBAAyB,CAAC,QAAa,MAAW,SAA2B,cAAmB,QAAW,SAAiB,OAAY;AACjJ,QAAM,YAAY;AAElB,MAAI;AACA,UAAM,UAAU,CAACA,SAAQC,OAAM,cAAc,OAAY;AACrD,aAAO,EAAE,UAAUD,SAAQ,CAAC,QAAQ,OAAO,QAAQ;AAC/C,cAAM,UAAkB,cAAc,GAAG,WAAW,IAAI,GAAa,KAAM;AAE3E,YAAI;AACA,cAAI,CAAC,EAAE,QAAQ,OAAOC,MAAK,GAAG,CAAC,MAAO,eAAe,YAAY,SAAS,OAAO,KAAM,gBAAgB,SAAY;AAC/G,gBAAI,EAAE,QAAQ,KAAK,GAAG;AAElB,kBAAI,EAAE,KAAK,OAAO,CAAC,SAAc,EAAE,SAAS,IAAI,CAAC,GAAG;AAEhD,sBAAM,MAAM,CAAC;AACb,oBAAI,QAAQ;AAEZ,yBAAS,IAAI,GAAG,KAAK,MAAM,SAAS,GAAG,KAAK;AACxC,wBAAM,MAAM,uBAAuB,MAAM,CAAC,GAAGA,MAAK,GAAG,KAAKA,MAAK,GAAG,EAAE,CAAC,IAAIA,MAAK,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,SAAS,aAAa,OAAO;AAEzH,sBAAI,CAAC,EAAE,QAAQ,GAAG,KAAK,QAAQ,KAAK,QAAQ,OAAO;AAE/C,wBAAI,KAAK,GAAG;AACZ,4BAAQ;AAAA,kBACZ,OAAO;AACH,wBAAI,KAAK,IAAI;AAAA,kBACjB;AAAA,gBACJ;AAEA,oBAAI,CAAC,OAAO;AACR,yBAAO,GAAG,IAAI;AAAA,gBAClB;AAAA,cACJ,OAAO;AAEH,wBAAQ,IAAI,KAAK,GAAG,IAAI,SAAS,CAAC,uBAAuBA,MAAK,GAAG,CAAC,UAAU,KAAK,GAAG;AACpF,oBAAI,CAAC,EAAE,QAAQ,OAAOA,MAAK,GAAG,CAAC,GAAG;AAC9B,yBAAO,GAAG,IAAI;AAAA,gBAClB;AAAA,cACJ;AAAA,YACJ,WAAW,EAAE,SAAS,KAAK,KAAK,EAAE,SAASA,MAAK,GAAG,CAAC,GAAG;AACnD,oBAAM,MAAM,QAAQ,OAAOA,MAAK,GAAG,IAAIA,MAAK,GAAG,IAAI,CAAC,GAAG,OAAO;AAC9D,kBAAI,CAAC,EAAE,QAAQ,GAAG,KAAK,QAAQ,KAAK,QAAQ,OAAO;AAC/C,uBAAO,GAAG,IAAI;AAAA,cAClB;AAAA,YACJ,OAAO;AACH,qBAAO,GAAG,IAAI;AAAA,YAClB;AAAA,UACJ;AAAA,QACJ,SAAS,OAAO;AACZ,kBAAQ,IAAI,MAAM,GAAG,SAAS,qBAAqB,KAAK,YAAY,MAAM,KAAK,cAAc,OAAO,aAAa,KAAK,UAAUD,OAAM,CAAC,WAAW,KAAK,UAAUC,KAAI,CAAC,EAAE;AAAA,QAC5K;AAAA,MACJ,CAAC;AAAA,IACL;AAEA,WAAO,QAAQ,QAAQ,MAAM,MAAM;AAAA,EACvC,SAAS,OAAO;AACZ,YAAQ,IAAI,MAAM,GAAG,SAAS,WAAW,KAAK,YAAY,MAAM,KAAK,aAAa,KAAK,UAAU,MAAM,CAAC,WAAW,KAAK,UAAU,IAAI,CAAC,EAAE;AAAA,EAC7I;AAEA,SAAO;AACX;AAQO,SAAS,2BAA2B,gBAA4G;AACnJ,QAAM,OAAO,CAAC;AAGd,WAAS,QAAQ,YAAY,SAAS,IAAU;AAC5C,MAAE,OAAO,YAAY,CAAC,OAAO,QAAQ;AACjC,YAAM,WAAW,SAAS,GAAG,MAAM,IAAI,GAAG,KAAK,KAAK,QAAQ,UAAU,EAAE,EAAE,QAAQ,WAAW,EAAE;AAG/F,UAAI,EAAE,SAAS,KAAK,KAAK,OAAO,UAAU,cAAc,QAAQ,UAAU;AACtE,aAAK,KAAK,OAAO;AAGjB,YAAI,EAAE,QAAQ,KAAK,KAAK,EAAE,SAAS,KAAK,GAAG;AAEvC,kBAAQ,OAAO,OAAO;AAAA,QAC1B;AAAA,MACJ,OAAO;AACH,YAAI,QAAQ,mBAAmB;AAC3B,gBAAM,gBAAgB,qBAAqB,MAAM;AACjD,eAAK,KAAK,GAAG,gBAAgB,GAAG,aAAa,MAAM,EAAE,GAAG,KAAK,EAAE;AAAA,QACnE;AAAA,MACJ;AAAA,IACJ,CAAC;AAAA,EACL;AAGA,UAAQ,cAAc;AAEtB,SAAO,EAAE,KAAK,IAAI;AACtB;AAEO,SAAS,0BAA0B,gBAA4G;AAClJ,QAAM,OAAO,CAAC;AAGd,WAAS,QAAQ,YAAY,SAAS,IAAU;AAC5C,MAAE,OAAO,YAAY,CAAC,OAAO,QAAQ;AACjC,UAAI,UAAU,SAAS,GAAG,MAAM,IAAI,GAAG,KAAK;AAE5C,UAAI,OAAO,OAAO,OAAO,WAAW,KAAK,CAAC,EAAE,SAAS,MAAM,SAAS,GAAG;AACnE,kBAAU,SAAS,GAAG,MAAM,IAAI,MAAM,SAAS,KAAK,MAAM;AAAA,MAC9D,WAAW,OAAO,OAAO,OAAO,IAAI,KAAK,CAAC,EAAE,SAAS,MAAM,EAAE,GAAG;AAC5D,kBAAU,SAAS,GAAG,MAAM,IAAI,MAAM,EAAE,KAAK,MAAM;AAAA,MACvD;AAEA,gBAAU,QAAQ,QAAQ,UAAU,EAAE,EAAE,QAAQ,WAAW,EAAE;AAG7D,UAAI,EAAE,SAAS,KAAK,KAAK,OAAO,UAAU,cAAc,QAAQ,UAAU;AACtE,YAAI,CAAC,EAAE,IAAI,OAAO,UAAU,GAAG;AAC3B,eAAK,KAAK,OAAO;AAAA,QACrB;AAGA,YAAI,EAAE,QAAQ,KAAK,KAAK,EAAE,SAAS,KAAK,GAAG;AAEvC,kBAAQ,OAAO,OAAO;AAAA,QAC1B;AAAA,MACJ;AAAA,IACJ,CAAC;AAAA,EACL;AAGA,UAAQ,cAAc;AAEtB,SAAO,EAAE,KAAK,IAAI;AACtB;AAEO,SAAS,iBAAiB,UAAkB,SAAmC;AAClF,MAAI,aAAa,MAAM;AACnB,WAAO;AAAA,EACX,WAAW,aAAa,MAAM;AAC1B,WAAO;AAAA,EACX,OAAO;AACH,YAAQ,IAAI,KAAK,SAAS,QAAQ,iEAAiE;AACnG,WAAO;AAAA,EACX;AACJ;AAEO,SAAS,sBAAsB,eAAuB,SAAmC;AAC5F,MAAI,kBAAkB,WAAW,kBAAkB,OAAO;AACtD,WAAO;AAAA,EACX,WAAW,kBAAkB,WAAW,kBAAkB,QAAQ;AAC9D,WAAO;AAAA,EACX,OAAO;AACH,YAAQ,IAAI,KAAK,SAAS,aAAa,iEAAiE;AACxG,WAAO;AAAA,EACX;AACJ;",
  "names": ["object", "base"]
}
